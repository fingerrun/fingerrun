<html lang="ko">
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T9HC454Z');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7QSEYCFK83"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7QSEYCFK83');
</script>

<meta name="viewport" content="width=device-width, initial-scale=0.67, maximum-scale=1.0, user-scalable=yes">
<title>핑거런 | 압도적인 디자인과 성능의 한글타자연습을 경험해보세요.</title>
<link rel="icon" type="image/svg+xml" href="../images/finger-run-logo.svg">
<link rel="shortcut icon" type="image/svg+xml" href="../images/finger-run-logo.svg">
<link rel="apple-touch-icon" href="../images/finger-run-logo.svg">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⌨️</text></svg>">
    
    <!-- SEO 메타태그 -->
<meta name="description" content="핑거런 타자연습 사이트에서 압도적인 디자인과 성능을 갖춘 한글타자연습을 경험하세요. 자음, 모음, 단어, 문장 단계별 학습과 실시간 AI 피드백, 키보드 가이드로 타이핑 속도와 정확도를 효과적으로 향상시킬 수 있는 최고의 한글 타자연습 사이트입니다.">
    <meta name="keywords" content="한글타자연습, 한글자판연습, 타자연습, 한글타자속도, 한글타자연습 사이트, 온라인 타자연습, 자음연습, 모음연습, 단어연습, 문장연습">
    <meta name="author" content="FingerRun">
    <meta name="robots" content="index, follow">

    <!-- Open Graph (SNS 공유) -->
    <meta property="og:title" content="핑거런 | 한글타자연습">
    <meta property="og:description" content="압도적인 디자인과 성능의 타자연습 사이트로 타이핑 속도와 정확도를 향상시키세요. 자음, 모음, 단어, 문장 단계별 학습.">
    <meta property="og:url" content="https://fingerrun.com/Korean/practice.html">
    <meta property="og:type" content="website">

    <!-- 추가 SEO -->
    <link rel="canonical" href="https://fingerrun.com/Korean/practice.html">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .nav-menu li {
            position: relative;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 0.5rem 0.8rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .nav-menu a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        /* 드롭다운 화살표 */
        .dropdown-arrow {
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        /* 드롭다운 메뉴 */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 10px;
            padding: 0.5rem 0;
            min-width: 180px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1001;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-menu li:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-menu li:hover .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu a {
            display: block;
            padding: 0.7rem 1rem;
            color: #333;
            border-radius: 0;
            font-weight: 400;
            transition: all 0.2s ease;
        }

        .dropdown-menu a:hover {
            background: #f8f9fa;
            color: #667eea;
            transform: none;
            padding-left: 1.2rem;
        }

        /* Main Container */
        .main-container {
            margin-top: 80px;
            padding: 2rem 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 2rem;
            padding-right: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .page-description {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
            white-space: nowrap;
        }

        /* Practice Container */
        .practice-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 3rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .practice-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        /* Menu Buttons */
        .practice-menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .menu-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            background: #f8f9fa;
            color: #667eea;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
        }

        .menu-btn:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .menu-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Practice Area */
        .practice-area {
            text-align: center;
            margin-bottom: 3rem;
        }

        .text-display {
            font-size: 1.8rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            min-height: 120px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            word-break: keep-all;
            letter-spacing: 2px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .text-display:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .text-display.sentence-mode {
            letter-spacing: 0.2px;
            line-height: 1.6;
            background: white;
            border: 2px solid #e2e8f0;
        }

        .text-display.sentence-mode:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .text-display.sentence-mode .char {
            margin: 0;
            padding: 0;
            background: none !important;
            border-radius: 0;
            transition: color 0.2s ease;
            color: #8b5cf6;
            font-weight: 500;
            box-shadow: none !important;
            transform: none !important;
            animation: none !important;
        }

        .text-display.sentence-mode .char.correct {
            color: #000000;
        }

        .text-display.sentence-mode .char.incorrect {
            color: #ff4444;
        }

        .text-display.sentence-mode .char.current {
            color: #3b82f6;
            background: none !important;
        }

        /* 띄어쓰기 스타일 */
        .text-display.sentence-mode .char.space {
            display: inline-block;
            width: 0.5em;
        }

        .char {
            margin: 3px;
            padding: 8px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #666;
            font-weight: 500;
        }

        .char.correct {
            color: white;
            background: linear-gradient(45deg, #4caf50, #45a049);
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }

        .char.incorrect {
            color: white;
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
        }

        .char.current {
            color: white;
            background: linear-gradient(45deg, #667eea, #764ba2);
            animation: pulse 1.5s infinite;
            transform: scale(1.15);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1.15); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Keyboard Area */
        .keyboard-area {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
        }

        .keyboard {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
            width: 100%;
            max-width: none;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 0.5rem;
            gap: 0.3rem;
        }

        .keyboard-row:last-child {
            margin-bottom: 0;
        }

        .key {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.8rem;
            min-width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.9rem;
            color: #495057;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .key:hover {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .key.active {
            background: linear-gradient(145deg, #ff6b6b, #ff5252) !important;
            color: white !important;
            border-color: #ff4444 !important;
            transform: scale(1.1) !important;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4) !important;
            animation: keyPulse 0.3s ease-in-out !important;
        }

        @keyframes keyPulse {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1.1); }
        }

        /* 특수 키 스타일 */
        .key.wide { min-width: 4rem; }
        .key.extra-wide { min-width: 6rem; }
        .key.space { min-width: 12rem; }
        .key.shift { min-width: 5rem; }
        .key.tab { min-width: 3.5rem; }
        .key.caps { min-width: 4.5rem; }
        .key.enter { min-width: 5.5rem; }
        .key.backspace { min-width: 4.5rem; }

        /* 한글/영어 표시 */
        .key-dual {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.1;
        }

        .key-en {
            font-size: 0.7rem;
            color: #6c757d;
        }

        .key-ko {
            font-size: 0.8rem;
            color: #495057;
            font-weight: 600;
        }

        /* Input Area */
        .input-area {
            margin-bottom: 3rem;
        }

        .typing-input {
            width: 100%;
            padding: 18px;
            font-size: 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            text-align: center;
            outline: none;
            background: white;
            color: #333;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .typing-input:focus {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 2px solid #e2e8f0;
        }

        .stat-item {
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.1);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.5s ease;
        }

        /* Enhanced Modal for AI Feedback */
        .modal-content.ai-feedback {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: left;
            padding: 2.5rem;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .complete-title {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
        }

        .ai-title {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            text-align: center;
        }

        .complete-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 3rem;
        }

        .complete-stat {
            text-align: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .complete-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .complete-label {
            color: #666;
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* AI Feedback Specific Styles */
        .feedback-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .feedback-section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .feedback-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        /* Speedometer */
        .speedometer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem 0;
        }

        .speedometer {
            position: relative;
            width: 300px; /* 1.5배 증가 (200px -> 300px) */
            height: 150px; /* 1.5배 증가 (100px -> 150px) */
            margin: 0 auto;
        }

        .speedometer-arc {
            width: 300px; /* 1.5배 증가 */
            height: 150px; /* 1.5배 증가 */
            border: 12px solid #e2e8f0; /* 테두리도 1.5배 증가 */
            border-bottom: none;
            border-radius: 300px 300px 0 0; /* 반지름도 1.5배 증가 */
            position: relative;
            background: linear-gradient(90deg, #ff4444 0%, #ffa500 25%, #ffff00 50%, #90EE90 75%, #4CAF50 100%);
            background-clip: padding-box;
        }

        .speedometer-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 6px; /* 1.5배 증가 */
            height: 120px; /* 1.5배 증가 */
            background: #333;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 2s ease-in-out;
            border-radius: 3px; /* 1.5배 증가 */
            z-index: 2;
        }

        .speedometer-center {
            position: absolute;
            bottom: -12px; /* 테두리 두께에 맞춰 조정 */
            left: 50%;
            width: 24px; /* 1.5배 증가 */
            height: 24px; /* 1.5배 증가 */
            background: #333;
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 3;
        }

        .speedometer-labels {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            font-size: 0.8rem;
            color: #666;
        }

        .speedometer-labels .left-label {
            position: absolute;
            left: 0;
            bottom: 0;
        }

        .speedometer-labels .right-label {
            position: absolute;
            right: 0;
            bottom: 0;
        }

                        /* VS 대결 구도 스타일 */
        .vs-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #e2e8f0;
        }

        .vs-player {
            flex: 1;
            text-align: center;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .vs-player.user {
            border: 3px solid #667eea;
        }

        .vs-player.average {
            border: 3px solid #28a745;
        }

        .vs-divider {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .vs-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #333;
        }

        .vs-stat {
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .vs-stat-label {
            color: #666;
            font-weight: 500;
        }

        .vs-stat-value {
            font-weight: 700;
            color: #667eea;
            margin-left: 0.5rem;
        }

        .vs-player.average .vs-stat-value {
            color: #28a745;
        }

        .skill-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .skill-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .skill-item.advice-item {
            grid-column: span 3;
            border-left: 3px solid #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }

        .skill-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .skill-score {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
        }

        .advice-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #2d5016;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .restart-btn, .continue-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            flex: 1;
        }

        .continue-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .restart-btn:hover, .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .continue-btn:hover {
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.5);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .feedback-section div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 1.5rem !important;
            }
            
            .nav-menu {
                gap: 1rem;
                flex-wrap: nowrap;
            }

            .nav-menu a {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
            }

            .dropdown-menu {
                min-width: 150px;
                font-size: 0.8rem;
            }

            .dropdown-menu a {
                padding: 0.5rem 0.8rem;
            }

            .practice-container {
                padding: 2rem;
                margin: 1rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .text-display {
                font-size: 1.5rem;
                padding: 1.5rem;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 1.5rem;
            }

            .practice-menu {
                gap: 10px;
            }

            .menu-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .modal-content {
                padding: 2rem;
                margin: 1rem;
            }

            .modal-content.ai-feedback {
                padding: 1.5rem;
                margin: 0.5rem;
            }

            .complete-title {
                font-size: 2.2rem;
            }

            .ai-title {
                font-size: 1.8rem;
            }

            .complete-value {
                font-size: 2rem;
            }

            .speedometer {
                width: 225px; /* 모바일에서도 1.5배 크기 유지 */
                height: 112px;
            }

            .speedometer-arc {
                width: 225px;
                height: 112px;
            }

            .speedometer-needle {
                height: 90px;
            }

            .skill-grid {
                grid-template-columns: 1fr;
            }

            .skill-item.advice-item {
                grid-column: span 1;
            }

            .modal-buttons {
                flex-direction: row; /* 한 줄 유지 */
                gap: 0.8rem;
            }

            .restart-btn, .continue-btn {
                padding: 12px 20px; /* 모바일에서 버튼 크기 조정 */
                font-size: 0.9rem;
                flex: 1; /* 동일한 크기 유지 */
            }

            /* 모바일 키보드 조정 */
            .keyboard {
                padding: 1rem;
            }

            .key {
                min-width: 1.8rem;
                height: 1.8rem;
                padding: 0.4rem;
                font-size: 0.7rem;
            }

            .key-dual {
                line-height: 1;
            }

            .key-en {
                font-size: 0.5rem;
            }

            .key-ko {
                font-size: 0.6rem;
            }

            .key.space {
                min-width: 6rem;
            }

            .key.shift {
                min-width: 2.5rem;
            }

            .key.enter {
                min-width: 3rem;
            }

            .key.backspace {
                min-width: 2.5rem;
            }

            .key.wide {
                min-width: 2rem;
            }

            .key.tab {
                min-width: 2rem;
            }

            .key.caps {
                min-width: 2.5rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .practice-container {
            animation: fadeInUp 0.8s ease-out;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="../index.html" class="logo">⌨️ FingerRun</a>
            <ul class="nav-menu">
                <li><a href="../notices.html">공지사항</a></li>
                <li>
                    <a href="practice.html">
                        한글 타자연습
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="practice.html" onclick="switchMode('consonant')">자음 연습</a>
                        <a href="practice.html" onclick="switchMode('vowel')">모음 연습</a>
                        <a href="practice.html" onclick="switchMode('word')">단어 연습</a>
                        <a href="practice.html" onclick="switchMode('sentence')">문장 연습</a>
                    </div>
                </li>
                <li>
                    <a href="../English/practice.html">
                        영어 타자연습
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="../English/practice.html" onclick="switchEnglishMode('alphabet')">알파벳 연습</a>
                        <a href="../English/practice.html" onclick="switchEnglishMode('word')">단어 연습</a>
                        <a href="../English/practice.html" onclick="switchEnglishMode('sentence')">문장 연습</a>
                    </div>
                </li>
                <li>
                    <a href="game-mole.html">
                        타자게임
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="game-mole.html">두더지 잡기 (한글)</a>
                        <a href="../English/game-mole.html">두더지 잡기 (영어)</a>
                        <a href="game-plane.html">비행기 조종 (한글)</a>
                        <a href="../English/game-plane.html">비행기 조종 (영어)</a>
                        <a href="game-delivery.html">택배 분류 (한글)</a>
                        <a href="../English/game-delivery.html">택배 분류 (영어)</a>
                    </div>
                </li>
                <li><a href="../writing.html">필사</a></li>
                <li>
                    <a href="../Certificate/word-processor.html">
                        자격증
                        <span class="dropdown-arrow">▼</span>
                    </a>
                    <div class="dropdown-menu">
                        <a href="../Certificate/word-processor.html">워드프로세서</a>
                    </div>
                </li>
                <li><a href="../contact.html">문의하기</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">한글 타자 연습</h1>
            <p class="page-description">체계적인 학습과 철저한 AI 피드백 분석으로 정확도와 속도를 향상시키세요.</p>
        </div>

        <!-- Practice Container -->
        <div class="practice-container">
            <!-- Practice Menu -->
            <div class="practice-menu">
                <button class="menu-btn active" data-mode="consonant">자음연습</button>
                <button class="menu-btn" data-mode="vowel">모음연습</button>
                <button class="menu-btn" data-mode="word">단어연습</button>
                <button class="menu-btn" data-mode="sentence">문장연습</button>
            </div>

            <!-- Practice Area -->
            <div class="practice-area">
                <div class="text-display" id="textDisplay"></div>

                <!-- Keyboard Area -->
                <div class="keyboard-area">
                    <div class="keyboard" id="keyboard">
                        <div class="keyboard-row">
                            <div class="key" data-key="`" data-ko=""><div class="key-dual"><span class="key-en">`</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="1" data-ko=""><div class="key-dual"><span class="key-en">1</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="2" data-ko=""><div class="key-dual"><span class="key-en">2</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="3" data-ko=""><div class="key-dual"><span class="key-en">3</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="4" data-ko=""><div class="key-dual"><span class="key-en">4</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="5" data-ko=""><div class="key-dual"><span class="key-en">5</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="6" data-ko=""><div class="key-dual"><span class="key-en">6</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="7" data-ko=""><div class="key-dual"><span class="key-en">7</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="8" data-ko=""><div class="key-dual"><span class="key-en">8</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="9" data-ko=""><div class="key-dual"><span class="key-en">9</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="0" data-ko=""><div class="key-dual"><span class="key-en">0</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="-" data-ko=""><div class="key-dual"><span class="key-en">-</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="=" data-ko=""><div class="key-dual"><span class="key-en">=</span><span class="key-ko"></span></div></div>
                            <div class="key backspace" data-key="Backspace">←</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key tab" data-key="Tab">Tab</div>
                            <div class="key" data-key="q" data-ko="ㅂ"><div class="key-dual"><span class="key-en">Q</span><span class="key-ko">ㅂ</span></div></div>
                            <div class="key" data-key="w" data-ko="ㅈ"><div class="key-dual"><span class="key-en">W</span><span class="key-ko">ㅈ</span></div></div>
                            <div class="key" data-key="e" data-ko="ㄷ"><div class="key-dual"><span class="key-en">E</span><span class="key-ko">ㄷ</span></div></div>
                            <div class="key" data-key="r" data-ko="ㄱ"><div class="key-dual"><span class="key-en">R</span><span class="key-ko">ㄱ</span></div></div>
                            <div class="key" data-key="t" data-ko="ㅅ"><div class="key-dual"><span class="key-en">T</span><span class="key-ko">ㅅ</span></div></div>
                            <div class="key" data-key="y" data-ko="ㅛ"><div class="key-dual"><span class="key-en">Y</span><span class="key-ko">ㅛ</span></div></div>
                            <div class="key" data-key="u" data-ko="ㅕ"><div class="key-dual"><span class="key-en">U</span><span class="key-ko">ㅕ</span></div></div>
                            <div class="key" data-key="i" data-ko="ㅑ"><div class="key-dual"><span class="key-en">I</span><span class="key-ko">ㅑ</span></div></div>
                            <div class="key" data-key="o" data-ko="ㅐ"><div class="key-dual"><span class="key-en">O</span><span class="key-ko">ㅐ</span></div></div>
                            <div class="key" data-key="p" data-ko="ㅔ"><div class="key-dual"><span class="key-en">P</span><span class="key-ko">ㅔ</span></div></div>
                            <div class="key" data-key="[" data-ko=""><div class="key-dual"><span class="key-en">[</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="]" data-ko=""><div class="key-dual"><span class="key-en">]</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="\\" data-ko=""><div class="key-dual"><span class="key-en">\\</span><span class="key-ko"></span></div></div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key caps" data-key="CapsLock">Caps</div>
                            <div class="key" data-key="a" data-ko="ㅁ"><div class="key-dual"><span class="key-en">A</span><span class="key-ko">ㅁ</span></div></div>
                            <div class="key" data-key="s" data-ko="ㄴ"><div class="key-dual"><span class="key-en">S</span><span class="key-ko">ㄴ</span></div></div>
                            <div class="key" data-key="d" data-ko="ㅇ"><div class="key-dual"><span class="key-en">D</span><span class="key-ko">ㅇ</span></div></div>
                            <div class="key" data-key="f" data-ko="ㄹ"><div class="key-dual"><span class="key-en">F</span><span class="key-ko">ㄹ</span></div></div>
                            <div class="key" data-key="g" data-ko="ㅎ"><div class="key-dual"><span class="key-en">G</span><span class="key-ko">ㅎ</span></div></div>
                            <div class="key" data-key="h" data-ko="ㅗ"><div class="key-dual"><span class="key-en">H</span><span class="key-ko">ㅗ</span></div></div>
                            <div class="key" data-key="j" data-ko="ㅓ"><div class="key-dual"><span class="key-en">J</span><span class="key-ko">ㅓ</span></div></div>
                            <div class="key" data-key="k" data-ko="ㅏ"><div class="key-dual"><span class="key-en">K</span><span class="key-ko">ㅏ</span></div></div>
                            <div class="key" data-key="l" data-ko="ㅣ"><div class="key-dual"><span class="key-en">L</span><span class="key-ko">ㅣ</span></div></div>
                            <div class="key" data-key=";" data-ko=""><div class="key-dual"><span class="key-en">;</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="'" data-ko=""><div class="key-dual"><span class="key-en">'</span><span class="key-ko"></span></div></div>
                            <div class="key enter" data-key="Enter">Enter</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key shift" data-key="ShiftLeft">Shift</div>
                            <div class="key" data-key="z" data-ko="ㅋ"><div class="key-dual"><span class="key-en">Z</span><span class="key-ko">ㅋ</span></div></div>
                            <div class="key" data-key="x" data-ko="ㅌ"><div class="key-dual"><span class="key-en">X</span><span class="key-ko">ㅌ</span></div></div>
                            <div class="key" data-key="c" data-ko="ㅊ"><div class="key-dual"><span class="key-en">C</span><span class="key-ko">ㅊ</span></div></div>
                            <div class="key" data-key="v" data-ko="ㅍ"><div class="key-dual"><span class="key-en">V</span><span class="key-ko">ㅍ</span></div></div>
                            <div class="key" data-key="b" data-ko="ㅠ"><div class="key-dual"><span class="key-en">B</span><span class="key-ko">ㅠ</span></div></div>
                            <div class="key" data-key="n" data-ko="ㅜ"><div class="key-dual"><span class="key-en">N</span><span class="key-ko">ㅜ</span></div></div>
                            <div class="key" data-key="m" data-ko="ㅡ"><div class="key-dual"><span class="key-en">M</span><span class="key-ko">ㅡ</span></div></div>
                            <div class="key" data-key="," data-ko=""><div class="key-dual"><span class="key-en">,</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="." data-ko=""><div class="key-dual"><span class="key-en">.</span><span class="key-ko"></span></div></div>
                            <div class="key" data-key="/" data-ko=""><div class="key-dual"><span class="key-en">/</span><span class="key-ko"></span></div></div>
                            <div class="key shift" data-key="ShiftRight">Shift</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key wide" data-key="ControlLeft">Ctrl</div>
                            <div class="key wide" data-key="MetaLeft">Win</div>
                            <div class="key wide" data-key="AltLeft">Alt</div>
                            <div class="key space" data-key=" ">Space</div>
                            <div class="key wide" data-key="AltRight">Alt</div>
                            <div class="key wide" data-key="MetaRight">Win</div>
                            <div class="key wide" data-key="ContextMenu">Menu</div>
                            <div class="key wide" data-key="ControlRight">Ctrl</div>
                        </div>
                    </div>
                </div>

                <div class="input-area">
                    <input type="text" class="typing-input" id="typingInput" placeholder="여기에 타이핑하세요...">
                </div>
            </div>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">100%</div>
                    <div class="stat-label">정확도</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="speed">0</div>
                    <div class="stat-label">타자/분</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="progress">0/10</div>
                    <div class="stat-label">진행률</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Modal -->
    <div class="modal" id="completeModal" style="display: none;">
        <div class="modal-content" id="modalContent">
            <h2 class="complete-title">연습 완료! 🎉</h2>
            <div class="complete-stats">
                <div class="complete-stat">
                    <div class="complete-value" id="finalAccuracy">100%</div>
                    <div class="complete-label">최종 정확도</div>
                </div>
                <div class="complete-stat">
                    <div class="complete-value" id="finalSpeed">0</div>
                    <div class="complete-label">평균 속도</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="restart-btn" id="restartBtn">다시 시작</button>
            </div>
        </div>
    </div>

    <script>
        class KoreanTypingPractice {
            constructor() {
                this.currentMode = 'consonant';
                this.currentText = '';
                this.currentPosition = 0;
                this.startTime = null;
                this.currentJamoSequence = [];
                this.currentJamoPosition = 0;
                this.currentProblem = 0;
                this.totalProblems = 10;
                this.usedWords = [];
                this.usedSentences = [];

                // AI 분석용 데이터 (문장연습 전용)
                this.sentenceTypingData = [];
                this.sentenceMistakes = [];
                this.sentenceKeyTimings = [];
                this.sentenceStartTime = null;
                this.lastKeyTime = null;
                this.lastKeyPressed = null;
                this.keyTransitions = []; // 키 이동 패턴 분석용
                
                // 각 문장별 통계 저장용 (새로 추가)
                this.sentenceStats = [];

                // 한글 자모 매핑
                this.koreanKeyMap = {
                    'q': 'ㅂ', 'w': 'ㅈ', 'e': 'ㄷ', 'r': 'ㄱ', 't': 'ㅅ',
                    'y': 'ㅛ', 'u': 'ㅕ', 'i': 'ㅑ', 'o': 'ㅐ', 'p': 'ㅔ',
                    'a': 'ㅁ', 's': 'ㄴ', 'd': 'ㅇ', 'f': 'ㄹ', 'g': 'ㅎ',
                    'h': 'ㅗ', 'j': 'ㅓ', 'k': 'ㅏ', 'l': 'ㅣ',
                    'z': 'ㅋ', 'x': 'ㅌ', 'c': 'ㅊ', 'v': 'ㅍ',
                    'b': 'ㅠ', 'n': 'ㅜ', 'm': 'ㅡ'
                };

                // 키보드 매핑 (한글 자모 -> 키)
                this.keyboardMap = {};
                for (let [key, korean] of Object.entries(this.koreanKeyMap)) {
                    this.keyboardMap[korean] = key;
                }

                // 추가 한글 자모 매핑 (복합모음, 쌍자음)
                this.keyboardMap['ㄲ'] = 'r';
                this.keyboardMap['ㄸ'] = 'e';
                this.keyboardMap['ㅃ'] = 'q';
                this.keyboardMap['ㅆ'] = 't';
                this.keyboardMap['ㅉ'] = 'w';
                this.keyboardMap['ㅒ'] = 'o';
                this.keyboardMap['ㅖ'] = 'p';
                this.keyboardMap[' '] = ' ';

                // 복합모음 매핑 (동시에 두 키 강조용)
                this.complexVowelMap = {
                    'ㅘ': ['h', 'k'], 'ㅙ': ['h', 'o'], 'ㅚ': ['h', 'l'],
                    'ㅝ': ['n', 'j'], 'ㅞ': ['n', 'p'], 'ㅟ': ['n', 'l'], 'ㅢ': ['m', 'l']
                };

                // 키보드 위치 매핑 (행, 열 좌표)
                this.keyPositions = {
                    'q': [1, 0], 'w': [1, 1], 'e': [1, 2], 'r': [1, 3], 't': [1, 4],
                    'y': [1, 5], 'u': [1, 6], 'i': [1, 7], 'o': [1, 8], 'p': [1, 9],
                    'a': [2, 0], 's': [2, 1], 'd': [2, 2], 'f': [2, 3], 'g': [2, 4],
                    'h': [2, 5], 'j': [2, 6], 'k': [2, 7], 'l': [2, 8],
                    'z': [3, 0], 'x': [3, 1], 'c': [3, 2], 'v': [3, 3], 'b': [3, 4],
                    'n': [3, 5], 'm': [3, 6], ' ': [4, 0] // 스페이스바
                };

                // 손가락별 키 할당
                this.fingerAssignment = {
                    'q': '왼새끼', 'a': '왼새끼', 'z': '왼새끼',
                    'w': '왼약지', 's': '왼약지', 'x': '왼약지',
                    'e': '왼중지', 'd': '왼중지', 'c': '왼중지',
                    'r': '왼검지', 'f': '왼검지', 'v': '왼검지', 't': '왼검지', 'g': '왼검지', 'b': '왼검지',
                    'y': '오검지', 'h': '오검지', 'n': '오검지', 'u': '오검지', 'j': '오검지', 'm': '오검지',
                    'i': '오중지', 'k': '오중지',
                    'o': '오약지', 'l': '오약지',
                    'p': '오새끼',
                    ' ': '엄지'
                };

                this.practiceData = {
                    consonant: ['ㄱ', 'ㄴ', 'ㄷ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅅ', 'ㅇ', 'ㅈ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ', 'ㄲ', 'ㄸ', 'ㅃ', 'ㅆ', 'ㅉ'],
                    vowel: ['ㅏ', 'ㅑ', 'ㅓ', 'ㅕ', 'ㅗ', 'ㅛ', 'ㅜ', 'ㅠ', 'ㅡ', 'ㅣ', 'ㅐ', 'ㅒ', 'ㅔ', 'ㅖ', 'ㅘ', 'ㅙ', 'ㅚ', 'ㅝ', 'ㅞ', 'ㅟ', 'ㅢ'],
                    word: {
                        easy: [
                            '사람', '학교', '집', '물', '불', '하늘', '땅', '바다', '산', '강',
                            '나무', '꽃', '새', '고양이', '개', '책', '연필', '의자', '책상', '문',
                            '창문', '시계', '전화', '컴퓨터', '텔레비전', '냉장고', '침대', '소파', '밥', '빵',
                            '우유', '사과', '바나나', '딸기', '포도', '오렌지', '아침', '점심', '저녁', '월요일',
                            '화요일', '수요일', '목요일', '금요일', '토요일', '일요일', '봄', '여름', '가을', '겨울',
                            '날씨', '비', '눈', '바람', '구름', '해', '달', '별', '빨간색', '파란색',
                            '노란색', '초록색', '하얀색', '검은색', '엄마', '아빠', '형', '동생', '할머니', '할아버지',
                            '병원', '약국', '은행', '우체국', '마트', '가게', '버스', '지하철', '택시', '자전거',
                            '자동차', '비행기', '기차', '배', '바지', '치마', '옷', '신발', '모자', '가방',
                            '우산', '돈', '카드', '휴대폰', '노트북', '마우스', '키보드', '음식', '물건', '장난감',
                            '운동', '축구', '야구', '농구', '수영', '달리기'
                        ],
                        medium: [
                            '정치', '경제', '사회', '문화', '과학', '기술', '역사', '철학', '예술', '음악',
                            '문학', '소설', '시인', '작가', '투자', '주식', '부동산', '창업', '혁신', '리더십',
                            '도전', '성공', '실패', '성장', '변화', '기회', '꿈', '목표', '열정', '노력',
                            '인내', '용기', '희망', '자신감', '책임', '정의', '평등', '자유', '민주주의', '인권',
                            '환경', '기후', '에너지', '미래', '발전', '교육', '연구', '실험', '발견', '창작',
                            '영감', '상상력', '지혜', '지식', '진리', '아름다움', '감동', '사랑', '우정', '가족',
                            '공동체', '소통', '이해', '배려', '감사', '행복', '평화', '건강', '여행', '모험',
                            '경험', '추억', '시간', '공간', '자연', '도시', '문명', '전통', '현대', '글로벌',
                            '디지털', '인공지능', '로봇', '우주', '생명', '의료', '치료', '예방', '운동', '스포츠',
                            '전략', '계획', '관리', '분석', '평가', '개선', '효율', '품질', '서비스', '고객',
                            '시장', '경쟁', '협력', '네트워크', '플랫폼', '데이터', '정보', '통신', '보안', '개인정보', '프라이버시'
                        ],
                        hard: [
                            '뿌리깊은', '빨갛게', '까맣게', '뽀얗게', '빠뜨리다', '뜨뜻미지근하다', '꺼칠꺼칠하다', '삐걱삐걱', '뒤뚱뒤뚱', '엇갈리다',
                            '얽혀있다', '웅성웅성', '우르르', '자글자글', '쭈글쭈글', '떨떠름하다', '우글우글', '쑥스럽다', '엉성하다', '삐뚤어지다',
                            '깜빡깜빡', '흐뭇하다', '아뜩하다', '까탈스럽다', '깔끔하다', '까무잡잡하다', '빼곡하다', '빙글빙글', '껄껄웃다', '킥킥거리다',
                            '씩씩하다', '쭉쭉뻗다', '휘청휘청', '흔들흔들', '울퉁불퉁', '데굴데굴', '뱅글뱅글', '껑충껑충', '팔랑팔랑', '펄럭펄럭',
                            '나풀나풀', '살랑살랑', '주렁주렁', '졸졸흐르다', '찰랑찰랑', '출렁출렁', '출렁거리다', '철썩철썩', '첨벙첨벙', '뛰어올라가다',
                            '주저앉다', '엎드리다', '우뚝서다', '뒤돌아보다', '내려다보다', '올려다보다', '가로질러가다', '비틀거리다', '뒤뚱거리다', '비스듬히',
                            '아슬아슬', '가파르다', '뾰족하다', '두루뭉술하다', '어깨동무하다', '손뼉치다', '발가락질하다', '눈짓하다', '머리감다', '이마찡그리다',
                            '코웃음치다', '입꾸물거리다'
                        ]
                    },
                    sentence: [
                        '창업 생태계 조성이 국가 경쟁력 향상의 핵심입니다.',
                        '비행기 모드로 충전하면 속도가 훨씬 빨라져요.',
                        '경제 성장과 사회 발전은 서로 밀접한 관련이 있습니다.',
                        '베이킹소다로 머그컵 얼룩을 간단히 지울 수 있죠.',
                        '인공지능이 인간의 삶을 어떻게 변화시킬까요?',
                        '옷에 껌 묻었을 땐 냉동 후에 떼면 편하답니다.',
                        '문화 다양성을 존중하는 사회가 더욱 발전할 수 있습니다.',
                        '신발 속에 티백 넣으면 냄새가 금방 사라져요.',
                        '기술 혁신이 우리의 미래를 바꾸고 있습니다.',
                        '물병에 시간 표시를 해두면 물 섭취량이 늘어요.',
                        '소셜미디어는 현대인의 의사소통을 크게 변화시켰습니다.',
                        '케이블 끝에 스프링을 감아 꺾임을 예방하세요.',
                        '민주주의는 시민의 참여로 완성됩니다.',
                        '세탁기에 식초+고온세탁으로 냄새를 없앨 수 있죠.',
                        '교육의 힘으로 더 나은 세상을 만들어갑시다.',
                        '양파를 냉동 10분 뒤 자르면 눈물이 덜 난답니다.',
                        '환경 보호는 다음 세대를 위한 중요한 과제입니다.',
                        '옷장 속 습기는 신문지로도 쉽게 잡을 수 있어요.',
                        '글로벌 시대에는 소통 능력이 필수입니다.',
                        '씨 없는 포도 얼리면 달콤한 간식이 되죠.',
                        '지속가능한 발전을 위해서는 모두의 노력이 필요합니다.',
                        '휴지심에 비닐 넣으면 깔끔하게 뽑아 쓰기 좋아요.',
                        '실패는 성공으로 가는 과정일 뿐입니다.',
                        '냄비 위 나무주걱 올려두면 거품이 안 넘치죠.',
                        '기후변화 대응을 위한 국제적 협력이 시급합니다.',
                        '거울에 비누칠하면 김서림 없이 쓸 수 있답니다.',
                        '꿈을 포기하지 않는 사람만이 성공할 수 있습니다.',
                        '휴지심 물주기는 화분 과습 방지에 효과 있죠.',
                        '건강한 라이프스타일을 유지하는 것은 매우 중요합니다.',
                        '지퍼에 연필심 문지르면 잘 올라간답니다.',
                        '디지털 전환이 모든 산업 분야에 영향을 미치고 있습니다.',
                        '빵 봉지에 사과 넣으면 신선하게 보관돼요.',
                        '인간관계에서 진정성과 신뢰가 가장 중요한 가치입니다.',
                        '창의적 사고가 문제 해결의 열쇠입니다.',
                        '스마트 기술이 일상생활을 편리하게 만들어주고 있습니다.',
                        '평생학습은 급변하는 시대를 살아가는 필수 조건입니다.'
                    ]
                };

                this.init();
            }

            init() {
                this.bindEvents();
                this.generateText();
                this.updateDisplay();
                
                // 초기 텍스트 표시 확인 및 강제 설정
                setTimeout(() => {
                    const display = document.getElementById('textDisplay');
                    if (!display.innerHTML || display.innerHTML.trim() === '' || !this.currentText) {
                        // 강제로 기본 텍스트 설정
                        this.currentText = 'ㄱ ㄴ ㄷ ㄹ ㅁ ㅂ ㅅ';
                        this.currentPosition = 0;
                        this.generateJamoSequence();
                        this.updateDisplay();
                    }
                }, 100);
            }

            bindEvents() {
                document.querySelectorAll('.menu-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.changeMode(e.target.dataset.mode);
                    });
                });

                const typingInput = document.getElementById('typingInput');
                
                typingInput.addEventListener('input', (e) => {
                    try {
                        this.handleInput(e.target.value);
                    } catch (error) {
                        document.getElementById('accuracy').textContent = '100%';
                        document.getElementById('speed').textContent = '0';
                    }
                });

                typingInput.addEventListener('keydown', (e) => {
                    // 문장연습에서만 키 타이밍 기록
                    if (this.currentMode === 'sentence') {
                        this.recordKeyTiming(e.key);
                    }
                    
                    if ((e.key === ' ' || e.key === 'Enter') && this.currentPosition >= this.currentText.length) {
                        e.preventDefault();
                        
                        // 문장 완료 시 통계 저장 확인
                        if (this.currentMode === 'sentence') {
                            const currentAccuracy = parseInt(document.getElementById('accuracy').textContent.replace('%', ''));
                            const currentSpeed = parseInt(document.getElementById('speed').textContent);
                            
                            // 이미 저장되었는지 확인
                            const alreadyStored = this.sentenceStats.some(stat => stat.sentenceNumber === this.currentProblem + 1);
                            
                            if (!alreadyStored) {
                                const sentenceData = {
                                    sentenceNumber: this.currentProblem + 1,
                                    accuracy: currentAccuracy,
                                    speed: currentSpeed
                                };
                                
                                this.sentenceStats.push(sentenceData);
                                console.log(`키다운에서 문장${this.currentProblem + 1} 저장 - 정확도: ${currentAccuracy}%, 속도: ${currentSpeed}타/분`);
                            }
                        }
                        
                        this.nextProblem();
                    }
                });

                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.restart();
                });
            }

            recordKeyTiming(key) {
                const now = Date.now();
                if (this.lastKeyTime) {
                    const interval = now - this.lastKeyTime;
                    this.sentenceKeyTimings.push({
                        key: key,
                        interval: interval,
                        position: this.currentPosition,
                        timestamp: now - this.sentenceStartTime
                    });

                    // 키 이동 패턴 분석
                    if (this.lastKeyPressed && key !== this.lastKeyPressed) {
                        const fromKey = this.lastKeyPressed.toLowerCase();
                        const toKey = key.toLowerCase();
                        
                        // 영문 키만 분석 (한글 자모는 영문 키로 변환)
                        const fromEngKey = this.getEnglishKey(fromKey);
                        const toEngKey = this.getEnglishKey(toKey);
                        
                        if (fromEngKey && toEngKey && this.keyPositions[fromEngKey] && this.keyPositions[toEngKey]) {
                            this.keyTransitions.push({
                                from: fromEngKey,
                                to: toEngKey,
                                fromChar: this.lastKeyPressed,
                                toChar: key,
                                interval: interval,
                                distance: this.calculateKeyDistance(fromEngKey, toEngKey),
                                fingerTransition: this.getFingerTransition(fromEngKey, toEngKey)
                            });
                        }
                    }
                }
                this.lastKeyTime = now;
                this.lastKeyPressed = key;
            }

            getEnglishKey(key) {
                // 한글 자모를 영문 키로 변환
                for (let [engKey, korChar] of Object.entries(this.koreanKeyMap)) {
                    if (korChar === key) return engKey;
                }
                // 이미 영문이면 그대로 반환
                return key === ' ' ? ' ' : key.toLowerCase();
            }

            calculateKeyDistance(key1, key2) {
                const pos1 = this.keyPositions[key1];
                const pos2 = this.keyPositions[key2];
                if (!pos1 || !pos2) return 0;
                
                // 유클리드 거리 계산
                return Math.sqrt(Math.pow(pos2[0] - pos1[0], 2) + Math.pow(pos2[1] - pos1[1], 2));
            }

            getFingerTransition(key1, key2) {
                const finger1 = this.fingerAssignment[key1];
                const finger2 = this.fingerAssignment[key2];
                
                if (finger1 === finger2) return '같은손가락';
                if (finger1 && finger2) {
                    if ((finger1.includes('왼') && finger2.includes('왼')) || 
                        (finger1.includes('오') && finger2.includes('오'))) {
                        return '같은손';
                    }
                    return '다른손';
                }
                return '알수없음';
            }

            changeMode(mode) {
                this.currentMode = mode;
                this.currentProblem = 0;
                this.resetStats();
                
                // 문장연습으로 변경시 문제 수를 3개로 변경
                if (mode === 'sentence') {
                    this.totalProblems = 3;
                    this.sentenceTypingData = [];
                    this.sentenceMistakes = [];
                    this.sentenceKeyTimings = [];
                    this.sentenceStats = []; // 문장별 통계 초기화
                } else {
                    this.totalProblems = 10;
                }
                
                document.querySelectorAll('.menu-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                
                this.generateText();
                this.updateDisplay();
                document.getElementById('typingInput').value = '';
                document.getElementById('typingInput').focus();
            }

            generateText() {
                const data = this.practiceData[this.currentMode];
                
                try {
                    if (this.currentMode === 'consonant' || this.currentMode === 'vowel') {
                        const selected = [];
                        for (let i = 0; i < 7; i++) {
                            selected.push(data[Math.floor(Math.random() * data.length)]);
                        }
                        this.currentText = selected.join(' ');
                    } else if (this.currentMode === 'word') {
                        const selected = [];
                        const easyWords = this.practiceData.word.easy.filter(word => !this.usedWords.includes(word));
                        const mediumWords = this.practiceData.word.medium.filter(word => !this.usedWords.includes(word));
                        const hardWords = this.practiceData.word.hard.filter(word => !this.usedWords.includes(word));
                        
                        if (easyWords.length === 0 && mediumWords.length === 0 && hardWords.length === 0) {
                            this.usedWords = [];
                        }
                        
                        const availableEasy = easyWords.length > 0 ? easyWords : this.practiceData.word.easy;
                        const availableMedium = mediumWords.length > 0 ? mediumWords : this.practiceData.word.medium;
                        const availableHard = hardWords.length > 0 ? hardWords : this.practiceData.word.hard;
                        
                        const easyWord = availableEasy[Math.floor(Math.random() * availableEasy.length)];
                        const mediumWord = availableMedium[Math.floor(Math.random() * availableMedium.length)];
                        const hardWord = availableHard[Math.floor(Math.random() * availableHard.length)];
                        
                        this.usedWords.push(easyWord, mediumWord, hardWord);
                        
                        const words = [easyWord, mediumWord, hardWord];
                        for (let i = words.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [words[i], words[j]] = [words[j], words[i]];
                        }
                        
                        this.currentText = words.join(' ');
                    } else {
                        const availableSentences = data.filter(sentence => !this.usedSentences.includes(sentence));
                        
                        if (availableSentences.length === 0) {
                            this.usedSentences = [];
                            availableSentences.push(...data);
                        }
                        
                        const randomIndex = Math.floor(Math.random() * availableSentences.length);
                        this.currentText = availableSentences[randomIndex];
                        
                        this.usedSentences.push(this.currentText);
                    }

                    this.currentPosition = 0;
                    this.startTime = null;
                    this.currentJamoSequence = [];
                    this.currentJamoPosition = 0;

                    // 문장연습에서만 문장별 타이밍 초기화
                    if (this.currentMode === 'sentence') {
                        this.sentenceStartTime = null;
                        this.lastKeyTime = null;
                        this.sentenceKeyTimings = [];
                        this.lastKeyPressed = null;
                        this.keyTransitions = [];
                    }

                    this.generateJamoSequence();
                    this.updateKeyboardHighlight();

                    const textDisplay = document.getElementById('textDisplay');
                    if (this.currentMode === 'sentence') {
                        textDisplay.classList.add('sentence-mode');
                    } else {
                        textDisplay.classList.remove('sentence-mode');
                    }
                } catch (error) {
                    // 텍스트 생성 오류시 기본 텍스트로 fallback
                    this.currentText = this.currentMode === 'consonant' ? 'ㄱ ㄴ ㄷ ㄹ ㅁ ㅂ ㅅ' : 
                                     this.currentMode === 'vowel' ? 'ㅏ ㅑ ㅓ ㅕ ㅗ ㅛ ㅜ' :
                                     this.currentMode === 'word' ? '사람 학교 집' :
                                     '안녕하세요 타자연습을 시작해보세요';
                }
            }

            generateJamoSequence() {
                this.currentJamoSequence = [];
                for (let i = 0; i < this.currentText.length; i++) {
                    const char = this.currentText[i];
                    if (char === ' ') {
                        this.currentJamoSequence.push(' ');
                    } else {
                        const decomposed = this.decomposeHangul(char);
                        if (decomposed && decomposed.length > 0) {
                            for (let jamo of decomposed) {
                                this.currentJamoSequence.push(jamo);
                            }
                        } else {
                            this.currentJamoSequence.push(char);
                        }
                    }
                }
            }

            countJaso(text) {
                let jasoCount = 0;
                for (let char of text) {
                    try {
                        if (char === ' ') {
                            jasoCount += 1;
                        } else if (/[가-힣]/.test(char)) {
                            const unicode = char.charCodeAt(0) - 0xAC00;
                            if (unicode >= 0 && unicode <= 11171) {
                                const jong = unicode % 28;
                                jasoCount += 2;
                                if (jong > 0) jasoCount += 1;
                            } else {
                                jasoCount += 1;
                            }
                        } else {
                            jasoCount += 1;
                        }
                    } catch (error) {
                        jasoCount += 1;
                    }
                }
                return jasoCount;
            }

            updateDisplay() {
                try {
                    const display = document.getElementById('textDisplay');
                    display.innerHTML = '';
                    
                    // 텍스트가 없으면 기본값 설정
                    if (!this.currentText) {
                        this.currentText = this.currentMode === 'consonant' ? 'ㄱ ㄴ ㄷ ㄹ ㅁ ㅂ ㅅ' : 
                                         this.currentMode === 'vowel' ? 'ㅏ ㅑ ㅓ ㅕ ㅗ ㅛ ㅜ' :
                                         this.currentMode === 'word' ? '사람 학교 집' :
                                         '안녕하세요 타자연습을 시작해보세요';
                    }

                    for (let i = 0; i < this.currentText.length; i++) {
                        const span = document.createElement('span');
                        span.className = 'char';
                        
                        if (this.currentText[i] === ' ') {
                            span.innerHTML = '&nbsp;';
                            span.classList.add('space');
                        } else {
                            span.textContent = this.currentText[i];
                        }

                        if (i < this.currentPosition) {
                            span.classList.add('correct');
                        } else if (i === this.currentPosition) {
                            span.classList.add('current');
                        }

                        display.appendChild(span);
                    }

                    if (this.currentMode === 'sentence') {
                        this.applyInitialColors();
                    }

                    this.updateKeyboardHighlight();
                    document.getElementById('progress').textContent = `${this.currentProblem + 1}/${this.totalProblems}`;
                } catch (error) {
                    // UI 렌더링 오류 시 기본 텍스트 강제 표시
                    const display = document.getElementById('textDisplay');
                    if (display) {
                        display.innerHTML = '<span class="char current">ㄱ</span><span class="char"> </span><span class="char">ㄴ</span><span class="char"> </span><span class="char">ㄷ</span>';
                    }
                }
            }

            decomposeHangul(char) {
                const code = char.charCodeAt(0);
                
                if ((code >= 0x3131 && code <= 0x314E) || (code >= 0x314F && code <= 0x3163)) {
                    switch (char) {
                        case 'ㅘ': return ['ㅗ', 'ㅏ'];
                        case 'ㅙ': return ['ㅗ', 'ㅐ'];
                        case 'ㅚ': return ['ㅗ', 'ㅣ'];
                        case 'ㅝ': return ['ㅜ', 'ㅓ'];
                        case 'ㅞ': return ['ㅜ', 'ㅔ'];
                        case 'ㅟ': return ['ㅜ', 'ㅣ'];
                        case 'ㅢ': return ['ㅡ', 'ㅣ'];
                        case 'ㅒ': return ['ㅐ', 'ㅣ'];
                        case 'ㅖ': return ['ㅔ', 'ㅣ'];
                        default: return [char];
                    }
                }

                if (code >= 0xAC00 && code <= 0xD7A3) {
                    const baseCode = code - 0xAC00;
                    const choIndex = Math.floor(baseCode / 588);
                    const jungIndex = Math.floor((baseCode % 588) / 28);
                    const jongIndex = baseCode % 28;

                    const choSeong = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];
                    const jungSeong = ['ㅏ', 'ㅐ', 'ㅑ', 'ㅒ', 'ㅓ', 'ㅔ', 'ㅕ', 'ㅖ', 'ㅗ', 'ㅘ', 'ㅙ', 'ㅚ', 'ㅛ', 'ㅜ', 'ㅝ', 'ㅞ', 'ㅟ', 'ㅠ', 'ㅡ', 'ㅢ', 'ㅣ'];
                    const jongSeong = ['', 'ㄱ', 'ㄲ', 'ㄳ', 'ㄴ', 'ㄵ', 'ㄶ', 'ㄷ', 'ㄹ', 'ㄺ', 'ㄻ', 'ㄼ', 'ㄽ', 'ㄾ', 'ㄿ', 'ㅀ', 'ㅁ', 'ㅂ', 'ㅄ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];

                    const result = [];

                    if (choSeong[choIndex]) {
                        result.push(choSeong[choIndex]);
                    }

                    const jung = jungSeong[jungIndex];
                    if (jung) {
                        switch (jung) {
                            case 'ㅘ': result.push('ㅗ'); result.push('ㅏ'); break;
                            case 'ㅙ': result.push('ㅗ'); result.push('ㅐ'); break;
                            case 'ㅚ': result.push('ㅗ'); result.push('ㅣ'); break;
                            case 'ㅝ': result.push('ㅜ'); result.push('ㅓ'); break;
                            case 'ㅞ': result.push('ㅜ'); result.push('ㅔ'); break;
                            case 'ㅟ': result.push('ㅜ'); result.push('ㅣ'); break;
                            case 'ㅢ': result.push('ㅡ'); result.push('ㅣ'); break;
                            case 'ㅒ': result.push('ㅐ'); result.push('ㅣ'); break;
                            case 'ㅖ': result.push('ㅔ'); result.push('ㅣ'); break;
                            default: result.push(jung); break;
                        }
                    }

                    if (jongSeong[jongIndex]) {
                        result.push(jongSeong[jongIndex]);
                    }

                    return result;
                }

                return null;
            }

            updateKeyboardHighlight() {
                document.querySelectorAll('.key').forEach(key => {
                    key.classList.remove('active');
                });

                if (this.currentMode === 'word' || this.currentMode === 'sentence') {
                    const inputValue = document.getElementById('typingInput').value;
                    let inputJamoCount = 0;

                    for (let i = 0; i < inputValue.length; i++) {
                        const char = inputValue[i];
                        if (char === ' ') {
                            inputJamoCount += 1;
                        } else {
                            const decomposed = this.decomposeHangul(char);
                            if (decomposed && decomposed.length > 0) {
                                inputJamoCount += decomposed.length;
                            } else {
                                inputJamoCount += 1;
                            }
                        }
                    }

                    if (inputJamoCount < this.currentJamoSequence.length) {
                        const currentJamo = this.currentJamoSequence[inputJamoCount];

                        if (currentJamo === ' ') {
                            const targetKey = document.querySelector(`[data-key=" "]`);
                            if (targetKey) {
                                targetKey.classList.add('active');
                            }
                        } else if (this.complexVowelMap[currentJamo]) {
                            const keys = this.complexVowelMap[currentJamo];
                            keys.forEach(keyName => {
                                const targetKey = document.querySelector(`[data-key="${keyName}"]`);
                                if (targetKey) {
                                    targetKey.classList.add('active');
                                }
                            });
                        } else {
                            const keyName = this.keyboardMap[currentJamo];
                            if (keyName) {
                                const targetKey = document.querySelector(`[data-key="${keyName}"]`);
                                if (targetKey) {
                                    targetKey.classList.add('active');
                                }
                            }
                        }
                    }
                } else {
                    if (this.currentPosition < this.currentText.length) {
                        const currentChar = this.currentText[this.currentPosition];

                        if (currentChar === ' ') {
                            const targetKey = document.querySelector(`[data-key=" "]`);
                            if (targetKey) {
                                targetKey.classList.add('active');
                            }
                        } else if (this.complexVowelMap[currentChar]) {
                            const keys = this.complexVowelMap[currentChar];
                            keys.forEach(keyName => {
                                const targetKey = document.querySelector(`[data-key="${keyName}"]`);
                                if (targetKey) {
                                    targetKey.classList.add('active');
                                }
                            });
                        } else {
                            const keyName = this.keyboardMap[currentChar];
                            if (keyName) {
                                const targetKey = document.querySelector(`[data-key="${keyName}"]`);
                                if (targetKey) {
                                    targetKey.classList.add('active');
                                }
                            }
                        }
                    }
                }
            }

            applyInitialColors() {
                const chars = document.querySelectorAll('.char');
                chars.forEach(char => {
                    char.style.color = '#8b5cf6';
                    char.style.background = 'none';
                    char.style.padding = '0';
                    char.style.borderRadius = '0';
                    char.style.boxShadow = 'none';
                    char.style.transform = 'none';
                });
            }

            handleInput(inputValue) {
                try {
                    if (!this.startTime) {
                        this.startTime = Date.now();
                        if (this.currentMode === 'sentence') {
                            this.sentenceStartTime = Date.now();
                        }
                    }

                    if (this.currentMode === 'sentence') {
                        const chars = document.querySelectorAll('.char');
                        let mistakes = [];

                        for (let i = 0; i < this.currentText.length; i++) {
                            const char = chars[i];
                            if (!char) continue;

                            char.style.background = 'none';
                            char.style.padding = '0';
                            char.style.borderRadius = '0';
                            char.style.boxShadow = 'none';
                            char.style.transform = 'none';

                            if (i < inputValue.length) {
                                if (inputValue[i] === this.currentText[i]) {
                                    char.style.color = '#000000';
                                } else {
                                    char.style.color = '#ff4444';
                                    mistakes.push({
                                        position: i,
                                        expected: this.currentText[i],
                                        actual: inputValue[i],
                                        timestamp: Date.now() - this.sentenceStartTime
                                    });
                                }
                            } else if (i === inputValue.length) {
                                char.style.color = '#3b82f6';
                            } else {
                                char.style.color = '#8b5cf6';
                            }
                        }

                        // 문장연습에서 실수 기록
                        this.sentenceMistakes = mistakes;
                    } else {
                        const chars = document.querySelectorAll('.char');

                        for (let i = 0; i < this.currentText.length; i++) {
                            const char = chars[i];

                            if (i < inputValue.length) {
                                if (inputValue[i] === this.currentText[i]) {
                                    char.className = 'char correct';
                                } else {
                                    char.className = 'char incorrect';
                                }
                            } else {
                                char.className = 'char';
                                if (i === inputValue.length) {
                                    char.classList.add('current');
                                }
                            }
                        }
                    }

                    this.currentPosition = inputValue.length;
                    this.updateStats();
                    this.updateKeyboardHighlight();

                    if (inputValue === this.currentText) {
                        // 문장이 완료되면 IMMEDIATELY 현재 통계창의 정확도와 타자/분을 저장
                        if (this.currentMode === 'sentence') {
                            const currentAccuracy = parseInt(document.getElementById('accuracy').textContent.replace('%', ''));
                            const currentSpeed = parseInt(document.getElementById('speed').textContent);
                            
                            const sentenceData = {
                                sentenceNumber: this.currentProblem + 1,
                                accuracy: currentAccuracy,
                                speed: currentSpeed
                            };
                            
                            this.sentenceStats.push(sentenceData);
                            
                            console.log(`문장${this.currentProblem + 1} 완료 - 통계창에서 저장됨:`);
                            console.log(`  정확도: ${currentAccuracy}%`);
                            console.log(`  속도: ${currentSpeed}타/분`);
                            console.log(`sentenceStats 배열:`, this.sentenceStats);
                        }
                        
                        this.recordSentenceData();
                    }
                } catch (error) {
                    document.getElementById('accuracy').textContent = '100%';
                    document.getElementById('speed').textContent = '0';
                }
            }

            recordSentenceData() {
                if (this.currentMode === 'sentence') {
                    const sentenceTime = Date.now() - this.sentenceStartTime;
                    
                    // 한글 자소 단위로 정확도 계산 (원래 방식과 동일)
                    const currentTextJasoCount = this.countJaso(this.currentText);
                    const inputValue = document.getElementById('typingInput').value;
                    let currentCorrectJaso = 0;
                    
                    for (let i = 0; i < Math.min(inputValue.length, this.currentText.length); i++) {
                        if (inputValue[i] === this.currentText[i]) {
                            currentCorrectJaso += this.countJaso(this.currentText[i]);
                        }
                    }
                    
                    const accuracy = currentTextJasoCount > 0 ? Math.round((currentCorrectJaso / currentTextJasoCount) * 100) : 100;
                    
                    // 한글 자소 단위로 타이핑 속도 계산 (원래 방식과 동일)
                    const jasoCount = this.countJaso(this.currentText);
                    const cpm = Math.round((jasoCount / (sentenceTime / 1000)) * 60);
                    
                    this.sentenceTypingData.push({
                        sentence: this.currentText,
                        time: sentenceTime,
                        accuracy: accuracy,
                        wpm: cpm, // 실제로는 CPM(자소/분)이지만 기존 변수명 유지
                        mistakes: [...this.sentenceMistakes],
                        keyTimings: [...this.sentenceKeyTimings]
                    });
                }
            }

            updateStats() {
                try {
                    const currentTextJasoCount = this.countJaso(this.currentText);
                    let currentCorrectJaso = 0;
                    
                    const inputValue = document.getElementById('typingInput').value;
                    
                    for (let i = 0; i < Math.min(inputValue.length, this.currentText.length); i++) {
                        if (inputValue[i] === this.currentText[i]) {
                            currentCorrectJaso += this.countJaso(this.currentText[i]);
                        }
                    }
                    
                    const accuracy = currentTextJasoCount > 0 ? Math.round((currentCorrectJaso / currentTextJasoCount) * 100) : 100;
                    document.getElementById('accuracy').textContent = `${accuracy}%`;

                    if (this.startTime) {
                        const elapsed = (Date.now() - this.startTime) / 1000;
                        const currentInputJasoCount = this.countJaso(inputValue);
                        const cpm = elapsed > 0 ? Math.round((currentInputJasoCount / elapsed) * 60) : 0;
                        document.getElementById('speed').textContent = cpm;
                    } else {
                        document.getElementById('speed').textContent = '0';
                    }
                } catch (error) {
                    document.getElementById('accuracy').textContent = '100%';
                    document.getElementById('speed').textContent = '0';
                }
            }

            nextProblem() {
                try {
                    // 문장연습에서 문장 완료 시 통계 저장 (혹시 누락된 경우를 위해)
                    if (this.currentMode === 'sentence' && this.currentPosition >= this.currentText.length) {
                        const currentAccuracy = parseInt(document.getElementById('accuracy').textContent.replace('%', ''));
                        const currentSpeed = parseInt(document.getElementById('speed').textContent);
                        
                        // 이미 저장되었는지 확인 (중복 방지)
                        const alreadyStored = this.sentenceStats.some(stat => stat.sentenceNumber === this.currentProblem + 1);
                        
                        if (!alreadyStored) {
                            const sentenceData = {
                                sentenceNumber: this.currentProblem + 1,
                                accuracy: currentAccuracy,
                                speed: currentSpeed
                            };
                            
                            this.sentenceStats.push(sentenceData);
                            console.log(`nextProblem에서 문장${this.currentProblem + 1} 저장 - 정확도: ${currentAccuracy}%, 속도: ${currentSpeed}타/분`);
                        }
                    }
                    
                    this.currentProblem++;
                    console.log(`다음 문제로 이동: ${this.currentProblem + 1}/${this.totalProblems}`);
                    console.log(`현재 sentenceStats:`, this.sentenceStats);
                    
                    if (this.currentProblem >= this.totalProblems) {
                        console.log('모든 문장 완료! AI 피드백 표시');
                        this.showComplete();
                    } else {
                        this.generateText();
                        this.updateDisplay();
                        document.getElementById('typingInput').value = '';
                        document.getElementById('typingInput').focus();
                    }
                } catch (error) {
                    console.error('nextProblem 오류:', error);
                    // 다음 문제로 이동 오류 시 기본 상태 유지
                }
            }

            showComplete() {
                try {
                    if (this.currentMode === 'sentence') {
                        // 문장연습 완료시 AI 피드백 표시
                        this.showAIFeedback();
                    } else {
                        // 기존 완료 모달
                        const currentAccuracy = document.getElementById('accuracy').textContent;
                        const currentSpeed = document.getElementById('speed').textContent;

                        document.getElementById('finalAccuracy').textContent = currentAccuracy;
                        document.getElementById('finalSpeed').textContent = currentSpeed;
                        document.getElementById('completeModal').style.display = 'flex';
                    }
                } catch (error) {
                    document.getElementById('finalAccuracy').textContent = '100%';
                    document.getElementById('finalSpeed').textContent = '0';
                    document.getElementById('completeModal').style.display = 'flex';
                }
            }

            async showAIFeedback() {
                // 로딩 표시
                const modalContent = document.getElementById('modalContent');
                modalContent.className = 'modal-content ai-feedback';
                modalContent.innerHTML = `
                    <h2 class="ai-title">🤖 AI가 당신의 타이핑을 분석하고 있습니다...</h2>
                    <div style="text-align: center; padding: 3rem;">
                        <div class="loading"></div>
                        타이핑 패턴을 심층 분석 중입니다...
                    </div>
                `;
                document.getElementById('completeModal').style.display = 'flex';

                // 2초 후 분석 결과 표시
                setTimeout(() => {
                    this.generateAIFeedback();
                }, 2000);
            }

            generateAIFeedback() {
                // 디버깅: 각 문장별 통계 데이터 확인
                console.log("=== AI 피드백 디버깅 시작 ===");
                console.log("저장된 문장별 통계:", this.sentenceStats);
                
                // 각 문장별 저장된 통계 데이터 추출
                let sentence1Speed = 0, sentence1Accuracy = 0;
                let sentence2Speed = 0, sentence2Accuracy = 0;
                let sentence3Speed = 0, sentence3Accuracy = 0;
                
                if (this.sentenceStats.length >= 1) {
                    sentence1Speed = this.sentenceStats[0].speed || 0;
                    sentence1Accuracy = this.sentenceStats[0].accuracy || 0;
                    console.log("문장1 저장된 통계 - 속도:", sentence1Speed, "정확도:", sentence1Accuracy);
                }
                
                if (this.sentenceStats.length >= 2) {
                    sentence2Speed = this.sentenceStats[1].speed || 0;
                    sentence2Accuracy = this.sentenceStats[1].accuracy || 0;
                    console.log("문장2 저장된 통계 - 속도:", sentence2Speed, "정확도:", sentence2Accuracy);
                }
                
                if (this.sentenceStats.length >= 3) {
                    sentence3Speed = this.sentenceStats[2].speed || 0;
                    sentence3Accuracy = this.sentenceStats[2].accuracy || 0;
                    console.log("문장3 저장된 통계 - 속도:", sentence3Speed, "정확도:", sentence3Accuracy);
                }
                
                // 전체 평균 계산: (문장1 + 문장2 + 문장3) ÷ 3
                let totalAvgSpeed = 0;
                let totalAvgAccuracy = 0;
                
                if (this.sentenceStats.length > 0) {
                    totalAvgSpeed = (sentence1Speed + sentence2Speed + sentence3Speed) / 3;
                    totalAvgAccuracy = (sentence1Accuracy + sentence2Accuracy + sentence3Accuracy) / 3;
                    
                    console.log("계산 과정:");
                    console.log("속도 합계:", sentence1Speed + sentence2Speed + sentence3Speed);
                    console.log("정확도 합계:", sentence1Accuracy + sentence2Accuracy + sentence3Accuracy);
                    console.log("최종 평균 속도:", totalAvgSpeed);
                    console.log("최종 평균 정확도:", totalAvgAccuracy);
                } else {
                    // fallback: 현재 표시되는 값 사용
                    totalAvgSpeed = parseInt(document.getElementById('speed').textContent) || 0;
                    totalAvgAccuracy = parseInt(document.getElementById('accuracy').textContent.replace('%', '')) || 0;
                    console.log("fallback 사용 - 속도:", totalAvgSpeed, "정확도:", totalAvgAccuracy);
                }

                const currentSpeed = Math.round(totalAvgSpeed);
                const avgAccuracy = Math.round(totalAvgAccuracy);
                
                console.log("AI 피드백에 사용될 최종 값 - 속도:", currentSpeed, "정확도:", avgAccuracy);
                console.log("=== AI 피드백 디버깅 끝 ===");
                
                const totalMistakes = this.sentenceTypingData.reduce((sum, data) => sum + data.mistakes.length, 0);
                
                // 사용자 평균 기준으로 점수 계산 (정확도 95%, 속도 350타)
                // 속도 점수 계산 (0-100점) - 새로운 기준 적용
                let speedScore = 0;
                if (currentSpeed >= 600) speedScore = 100; // 전설
                else if (currentSpeed >= 500) speedScore = 90; // 매우 우수
                else if (currentSpeed >= 400) speedScore = 80; // 우수
                else if (currentSpeed >= 300) speedScore = 70; // 평균 (350타 기준)
                else if (currentSpeed >= 200) speedScore = 50; // 미흡
                else speedScore = Math.max(0, (currentSpeed / 200) * 50); // 매우 미흡

                // 정확도 점수 계산 (0-100점) - 95%를 평균으로 조정
                let accuracyScore = 0;
                if (avgAccuracy >= 99) accuracyScore = 100;
                else if (avgAccuracy >= 97) accuracyScore = 90;
                else if (avgAccuracy >= 95) accuracyScore = 70; // 사용자 평균
                else if (avgAccuracy >= 92) accuracyScore = 60;
                else if (avgAccuracy >= 88) accuracyScore = 50;
                else if (avgAccuracy >= 85) accuracyScore = 40;
                else if (avgAccuracy >= 80) accuracyScore = 30;
                else accuracyScore = Math.max(0, (avgAccuracy / 80) * 30);

                // 전체 점수 (속도 50% + 정확도 50%)
                const totalScore = (speedScore * 0.5) + (accuracyScore * 0.5);

                // 전체 등급 계산
                let overallGrade, overallPercentile;
                if (totalScore >= 95) {
                    overallGrade = "전설급";
                    overallPercentile = "상위 1%";
                } else if (totalScore >= 85) {
                    overallGrade = "매우 우수";
                    overallPercentile = "상위 5%";
                } else if (totalScore >= 75) {
                    overallGrade = "우수";
                    overallPercentile = "상위 15%";
                } else if (totalScore >= 70) {
                    overallGrade = "평균 이상";
                    overallPercentile = "상위 30%";
                } else if (totalScore >= 65) {
                    overallGrade = "평균";
                    overallPercentile = "평균 수준";
                } else if (totalScore >= 45) {
                    overallGrade = "평균 미만";
                    overallPercentile = "하위 40%";
                } else {
                    overallGrade = "개선 필요";
                    overallPercentile = "하위 20%";
                }

                // 속도별 등급 (계기판용 - 종합 실력 기준으로 변경)
                let speedGrade, speedPercentile, needleRotation;
                if (totalScore >= 95) {
                    speedGrade = "전설급";
                    speedPercentile = "상위 1%";
                    needleRotation = 45;
                } else if (totalScore >= 85) {
                    speedGrade = "매우 우수";
                    speedPercentile = "상위 5%";
                    needleRotation = 35;
                } else if (totalScore >= 75) {
                    speedGrade = "우수";
                    speedPercentile = "상위 15%";
                    needleRotation = 20;
                } else if (totalScore >= 70) {
                    speedGrade = "평균 이상";
                    speedPercentile = "상위 30%";
                    needleRotation = 5;
                } else if (totalScore >= 65) {
                    speedGrade = "평균";
                    speedPercentile = "평균 수준";
                    needleRotation = -5;
                } else if (totalScore >= 45) {
                    speedGrade = "평균 미만";
                    speedPercentile = "하위 40%";
                    needleRotation = -20;
                } else {
                    speedGrade = "개선 필요";
                    speedPercentile = "하위 20%";
                    needleRotation = -40;
                }

                const commonMistakes = this.analyzeCommonMistakes();
                const feedback = this.generateDetailedFeedback(currentSpeed, avgAccuracy, speedGrade, overallGrade, overallPercentile);
                const advice = this.generatePersonalizedAdvice(currentSpeed, avgAccuracy, overallGrade);

                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = `
                    <h2 class="ai-title">🤖 AI 타이핑 분석 결과</h2>
                    
                    <div class="feedback-section">
                        <div class="feedback-section-title">📊 전체적인 성과</div>
                        
                        <!-- 계기판을 맨 위 가운데 배치 -->
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="speedometer-container">
                                <div class="speedometer">
                                    <div class="speedometer-arc"></div>
                                    <div class="speedometer-needle" id="speedometerNeedle" style="transform: translateX(-50%) rotate(-90deg);"></div>
                                    <div class="speedometer-center"></div>
                                </div>
                            </div>
                            <div class="speedometer-labels">
                                <span class="left-label">하위 20%</span>
                                <span class="right-label">상위 1%</span>
                            </div>
                            <div class="percentile-display">
                                종합 실력은 사용자 중 <strong>${overallPercentile}</strong>에 해당합니다!
                            </div>
                        </div>

                        <!-- VS 대결 구도 -->
                        <div class="vs-container">
                            <div class="vs-player user">
                                <div class="vs-title">🎯 나의 실력</div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">종합 등급:</span>
                                    <span class="vs-stat-value">${overallGrade}</span>
                                </div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">평균 타이핑 속도:</span>
                                    <span class="vs-stat-value">${currentSpeed}타/분</span>
                                </div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">평균 정확도:</span>
                                    <span class="vs-stat-value">${Math.round(avgAccuracy)}%</span>
                                </div>
                            </div>
                            
                            <div class="vs-divider">VS</div>
                            
                            <div class="vs-player average">
                                <div class="vs-title">📈 사용자 평균</div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">종합 등급:</span>
                                    <span class="vs-stat-value">평균</span>
                                </div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">평균 타이핑 속도:</span>
                                    <span class="vs-stat-value">350타/분</span>
                                </div>
                                <div class="vs-stat">
                                    <span class="vs-stat-label">평균 정확도:</span>
                                    <span class="vs-stat-value">95%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="feedback-section">
                        <div class="feedback-section-title">🎯 개선 방안</div>
                        <div class="feedback-text">
                            ${feedback.improvements}
                        </div>
                    </div>

                    <div class="feedback-section">
                        <div class="feedback-section-title">📈 목표 설정</div>
                        <div class="feedback-text">
                            ${feedback.goals}
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min((currentSpeed + 50) / 800 * 100, 100)}%"></div>
                        </div>
                    </div>

                    <div class="feedback-section">
                        <div class="feedback-section-title">🏆 종합 평가</div>
                        <div class="feedback-text" style="margin-bottom: 1.5rem;">
                            ${feedback.overallAssessment}
                        </div>
                        <div class="skill-grid">
                            <div class="skill-item">
                                <div class="skill-name">타이핑 속도</div>
                                <div class="skill-score">${currentSpeed >= 600 ? '전설' : currentSpeed >= 500 ? '매우 우수' : currentSpeed >= 400 ? '우수' : currentSpeed >= 300 ? '평균' : currentSpeed >= 200 ? '미흡' : '매우 미흡'} (${currentSpeed}타/분)</div>
                            </div>
                            <div class="skill-item">
                                <div class="skill-name">정확도</div>
                                <div class="skill-score">${avgAccuracy >= 99 ? '매우 정확' : avgAccuracy >= 97 ? '정확' : avgAccuracy >= 95 ? '평균' : avgAccuracy >= 92 ? '평균 미만' : '개선 필요'} (${Math.round(avgAccuracy)}%)</div>
                            </div>
                            <div class="skill-item">
                                <div class="skill-name">일관성</div>
                                <div class="skill-score">${this.sentenceTypingData.length > 1 && (Math.max(...this.sentenceTypingData.map(d => d.wpm)) - Math.min(...this.sentenceTypingData.map(d => d.wpm))) < 10 ? '매우 일관적' : 
                                    this.sentenceTypingData.length > 1 && (Math.max(...this.sentenceTypingData.map(d => d.wpm)) - Math.min(...this.sentenceTypingData.map(d => d.wpm))) < 20 ? '일관적' : '개선 필요'}</div>
                            </div>
                            <div class="skill-item advice-item">
                                <div class="skill-name">💡 개인 맞춤 조언</div>
                                <div class="advice-content">${advice}</div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-buttons">
                        <button class="restart-btn" id="restartBtn">다시 시작하기</button>
                        <button class="continue-btn" id="continueBtn">더 연습하기</button>
                    </div>
                `;

                // 버튼 이벤트 재바인딩
                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.restart();
                });

                document.getElementById('continueBtn').addEventListener('click', () => {
                    this.continuePractice();
                });

                // 계기판 애니메이션 효과
                setTimeout(() => {
                    const needle = document.getElementById('speedometerNeedle');
                    if (needle) {
                        needle.style.transform = `translateX(-50%) rotate(${needleRotation}deg)`;
                    }
                }, 500);
            }

            generatePersonalizedAdvice(currentSpeed, avgAccuracy, overallGrade) {
                if (overallGrade === "전설급") {
                    return "🌟 완벽한 실력입니다! 이제 실무에서 활용하거나 다른 사람들을 가르쳐보세요. 더 어려운 전문 용어나 코딩 연습에 도전해보는 것도 좋습니다. 정기적으로 실력을 유지하기 위해 주 2-3회 정도 연습을 지속하세요.";
                } else if (overallGrade === "매우 우수" || overallGrade === "우수") {
                    return "🎯 훌륭한 실력입니다! 일정한 리듬을 유지하며 긴 문서 타이핑 연습을 해보세요. 실무 문서나 뉴스 기사 타이핑으로 실전 감각을 기르는 것을 추천합니다. 손목 스트레칭과 정확한 자세 유지가 중요합니다.";
                } else if (overallGrade === "평균 이상") {
                    if (avgAccuracy < 95) {
                        return "🎨 정확도를 95% 이상으로 높이는 것이 우선입니다. 천천히 정확하게 타이핑하는 습관을 기르고, 틀린 부분을 반복 연습하세요. 매일 15분 정도 정확도 집중 연습을 추천합니다. 속도는 정확도가 높아진 후 자연스럽게 향상됩니다.";
                    } else {
                        return "🚀 정확도는 좋으니 이제 속도를 높여보세요. 단어 단위로 인식하며 타이핑하고, 자주 사용하는 단어들을 빠르게 치는 연습을 하세요. 키보드 익숙함 향상을 위해 타자게임도 병행해보세요.";
                    }
                } else if (overallGrade === "평균") {
                    return "📚 기본기를 탄탄히 하는 시기입니다. 정확한 손가락 위치를 익히고, 매일 15-20분씩 꾸준히 연습하세요. 정확도를 먼저 95% 이상으로 높인 후 속도를 향상시키는 것이 중요합니다. 올바른 자세(손목을 키보드에 대지 않기)를 꼭 지켜주세요.";
                } else {
                    return "🌱 기초부터 차근차근 시작하세요. 자세 교정이 가장 중요합니다. 손목을 키보드에 대지 말고, 각 손가락의 담당 키를 정확히 익혀주세요. 처음에는 속도보다 정확도에 집중하고, 매일 10분씩이라도 꾸준히 연습하면 반드시 늘어납니다! 인내심을 갖고 꾸준히 하시면 됩니다.";
                }
            }

            continuePractice() {
                // 현재 문제 번호를 초기화하고 계속 진행
                this.currentProblem = 0;
                // 문장 연습 데이터는 유지
                this.generateText();
                this.updateDisplay();
                document.getElementById('typingInput').value = '';
                document.getElementById('completeModal').style.display = 'none';
                
                // 모달 클래스 초기화
                document.getElementById('modalContent').className = 'modal-content';
                
                document.getElementById('typingInput').focus();
            }

            generateDetailedFeedback(currentSpeed, avgAccuracy, speedGrade, overallGrade, overallPercentile) {
                // 현실적인 목표 설정 - 사용자 평균 기준 조정 (정확도 95% 기준)
                let targetSpeed, targetAccuracy, targetPercentile;
                
                // 정확도가 낮으면 속도보다 정확도 우선
                if (avgAccuracy < 88) {
                    targetAccuracy = Math.min(92, avgAccuracy + 4);
                    targetSpeed = currentSpeed + 20; // 속도는 조금만 증가
                    targetPercentile = "정확도 개선 우선";
                } else if (avgAccuracy < 92) {
                    targetAccuracy = Math.min(95, avgAccuracy + 3);
                    targetSpeed = currentSpeed + 30;
                    targetPercentile = "평균 수준 달성";
                } else if (avgAccuracy < 95) {
                    targetAccuracy = Math.min(97, avgAccuracy + 2);
                    targetSpeed = currentSpeed < 250 ? 350 : currentSpeed + 50;
                    targetPercentile = "평균 달성";
                } else if (avgAccuracy < 97) {
                    targetAccuracy = Math.min(99, avgAccuracy + 2);
                    targetSpeed = currentSpeed < 250 ? 350 : currentSpeed + 50;
                    targetPercentile = "평균 이상";
                } else {
                    // 정확도가 충분하면 속도 위주
                    targetAccuracy = Math.min(100, avgAccuracy + 1);
                    targetSpeed = currentSpeed < 250 ? 350 : 
                                 currentSpeed < 350 ? 450 : 
                                 currentSpeed < 450 ? 550 : 
                                 currentSpeed + 50;
                    targetPercentile = currentSpeed < 350 ? "평균 수준" : 
                                      currentSpeed < 450 ? "상위 30%" : 
                                      currentSpeed < 550 ? "상위 15%" : 
                                      currentSpeed < 650 ? "상위 5%" : "상위 1%";
                }

                const improvements = `
                    ${avgAccuracy < 92 ? 
                        '🎯 <strong>정확도 최우선:</strong> 속도를 늦추더라도 정확하게 타이핑하는 연습을 하세요. 사용자 평균 정확도 95% 달성이 첫 번째 목표입니다. 틀린 글자가 나올 때마다 즉시 멈추고 다시 정확하게 타이핑해보세요.<br>' : 
                        avgAccuracy < 95 ?
                        '🎯 <strong>평균 정확도 달성:</strong> 95% 이상의 정확도를 목표로 하세요. 이것이 사용자 평균 수준입니다. 백스페이스 사용을 최소화하고 처음부터 정확하게 타이핑하는 습관을 기르세요.<br>' :
                        avgAccuracy < 97 ?
                        '🎯 <strong>정확도 향상:</strong> 97% 이상의 정확도를 목표로 하세요. 실무에서 활용할 수 있는 수준입니다. 자주 틀리는 문자들을 따로 연습해보세요.<br>' :
                        ''
                    }
                    ${currentSpeed < 200 && avgAccuracy >= 85 ? 
                        '🔥 <strong>기본 자세 교정:</strong> 손목을 키보드에 대지 말고 손가락만 움직여 타이핑하세요. 정확한 손가락 위치를 익히는 것이 우선입니다. 각 손가락의 담당 키를 명확히 구분해서 연습하세요.<br>' : 
                        ''
                    }
                    ${this.analyzeCommonMistakes().length > 0 ? 
                        `⌨️ <strong>취약 문자 집중 연습:</strong> "${this.analyzeCommonMistakes().join(', ')}" 문자가 포함된 단어를 반복 연습하세요. 이 문자들을 천천히 정확하게 치는 연습을 매일 5분씩 해보세요.<br>` : 
                        ''
                    }
                    ${this.sentenceTypingData.length > 1 && this.calculateSpeedVariance() > 50 ? 
                        '📊 <strong>일정한 리듬 유지:</strong> 빠르게 치려고 하지 말고 일정한 리듬을 유지하며 타이핑하세요. 메트로놈을 활용하거나 마음속으로 일정한 박자를 세면서 연습해보세요.<br>' : 
                        ''
                    }
                    ${currentSpeed >= 400 && avgAccuracy >= 97 ? 
                        '🚀 <strong>고급 기법:</strong> 단어 단위로 인식하여 타이핑하는 연습을 시작하세요. 문장의 흐름을 미리 읽고 타이핑하면 더욱 빨라집니다. 시각적 기억과 근육 기억을 동시에 활용하세요.' : 
                        currentSpeed >= 200 && avgAccuracy >= 95 ?
                        '📈 <strong>속도 향상:</strong> 정확도를 유지하면서 점진적으로 속도를 높여보세요. 사용자 평균(350타)을 목표로 하되, 무리하지 말고 단계적으로 증가시키세요.' :
                        '📚 <strong>기초 연습:</strong> 매일 15-20분씩 정확도 위주로 연습하는 것이 가장 중요합니다. 기초가 탄탄해야 나중에 속도도 자연스럽게 향상됩니다.'
                    }
                `;

                const goals = `
                    <strong>단기 목표 (2주 내):</strong><br>
                    • 타이핑 속도: <span class="feedback-highlight">${Math.round(currentSpeed + (targetSpeed - currentSpeed) * 0.3)}타/분</span> 달성<br>
                    • 정확도: <span class="feedback-highlight">${Math.round(avgAccuracy + (targetAccuracy - avgAccuracy) * 0.6)}%</span> 달성<br><br>
                    
                    <strong>중기 목표 (1개월 내):</strong><br>
                    • 타이핑 속도: <span class="feedback-highlight">${targetSpeed}타/분</span> 달성<br>
                    • 정확도: <span class="feedback-highlight">${targetAccuracy}%</span> 달성<br>
                    • 실력 등급: <span class="feedback-highlight">${targetPercentile}</span> 진입<br><br>
                    
                    <strong>권장 연습 시간 및 방법:</strong><br>
                    ${avgAccuracy < 88 ? 
                        '매일 25-30분씩 정확도 집중 연습 (속도는 천천히). 틀린 문자 즉시 교정하기' : 
                        avgAccuracy < 92 ?
                        '매일 20-25분씩 기본기 다지기 (평균 달성 목표). 정확도 92% 우선' :
                        avgAccuracy < 95 ?
                        '매일 20-25분씩 정확도와 속도 균형 연습. 95% 정확도 달성 후 속도 향상' :
                        avgAccuracy < 97 ?
                        '매일 18-22분씩 정확도 향상과 속도 연습. 97% 정확도 목표' :
                        currentSpeed < 300 ? 
                        '매일 15-20분씩 속도 향상 위주 연습. 리듬감과 일관성 중시' : 
                        '매일 10-15분씩 고급 기법과 실전 연습. 긴 문서 타이핑 도전'
                    }
                `;

                const overallAssessment = overallGrade === "전설급" ? 
                    '축하합니다! 속도와 정확도 모두 최고 수준입니다. 이제 실무에서도 충분히 활용할 수 있는 완벽한 실력입니다!' :
                    overallGrade === "매우 우수" || overallGrade === "우수" ? 
                    '훌륭한 실력입니다! 속도와 정확도의 균형이 잘 잡혀있습니다. 조금만 더 연습하면 최고 수준에 도달할 수 있습니다.' :
                    overallGrade === "평균 이상" ? 
                    '사용자 평균을 넘어선 좋은 실력입니다. 속도나 정확도 중 부족한 부분을 집중적으로 연습하면 크게 향상될 수 있습니다.' :
                    overallGrade === "평균" ? 
                    '사용자 평균 수준에 근접한 실력입니다. 정확도를 먼저 높이고, 그 다음 속도를 향상시키는 순서로 연습하세요.' :
                    '기초부터 차근차근 연습이 필요합니다. 정확도를 95% 이상으로 높이는 것을 최우선 목표로 하세요. 사용자 평균에 도달하는 것이 첫 번째 목표입니다.';

                return {
                    improvements,
                    goals,
                    overallAssessment
                };
            }

            analyzeSlowTransitions() {
                if (this.keyTransitions.length < 5) return [];

                // 키 이동별 평균 시간 계산
                const transitionGroups = {};
                this.keyTransitions.forEach(transition => {
                    const key = `${transition.from}-${transition.to}`;
                    if (!transitionGroups[key]) {
                        transitionGroups[key] = {
                            intervals: [],
                            distance: transition.distance,
                            fingerTransition: transition.fingerTransition,
                            fromChar: transition.fromChar,
                            toChar: transition.toChar,
                            from: transition.from,
                            to: transition.to
                        };
                    }
                    transitionGroups[key].intervals.push(transition.interval);
                });

                // 각 이동 패턴의 평균 시간 계산
                const transitionStats = [];
                Object.entries(transitionGroups).forEach(([key, data]) => {
                    if (data.intervals.length >= 2) { // 최소 2번 이상 나타난 패턴만
                        const avgTime = data.intervals.reduce((a, b) => a + b, 0) / data.intervals.length;
                        const expectedTime = this.getExpectedTransitionTime(data.distance, data.fingerTransition);
                        
                        transitionStats.push({
                            key: key,
                            avgTime: avgTime,
                            expectedTime: expectedTime,
                            slowness: avgTime / expectedTime, // 예상 시간 대비 실제 시간 비율
                            distance: data.distance,
                            fingerTransition: data.fingerTransition,
                            fromChar: data.fromChar,
                            toChar: data.toChar,
                            from: data.from,
                            to: data.to,
                            count: data.intervals.length
                        });
                    }
                });

                // 가장 느린 3개 패턴 반환
                return transitionStats
                    .filter(stat => stat.slowness > 1.5) // 예상보다 50% 이상 느린 것만
                    .sort((a, b) => b.slowness - a.slowness)
                    .slice(0, 3)
                    .map(stat => ({
                        display: `${this.getKoreanChar(stat.fromChar)} → ${this.getKoreanChar(stat.toChar)}`,
                        slowness: stat.slowness,
                        fingerTransition: stat.fingerTransition,
                        advice: this.getTransitionAdvice(stat)
                    }));
            }

            getKoreanChar(char) {
                // 영문 키를 한글로 변환해서 표시
                return this.koreanKeyMap[char.toLowerCase()] || char;
            }

            getExpectedTransitionTime(distance, fingerTransition) {
                // 거리와 손가락 이동 패턴에 따른 예상 시간 (밀리초)
                let baseTime = 150; // 기본 150ms
                
                if (fingerTransition === '같은손가락') {
                    baseTime += distance * 50; // 같은 손가락은 더 느림
                } else if (fingerTransition === '같은손') {
                    baseTime += distance * 30;
                } else if (fingerTransition === '다른손') {
                    baseTime += distance * 20; // 다른 손은 상대적으로 빠름
                }
                
                return baseTime;
            }

            getTransitionAdvice(stat) {
                const finger = stat.fingerTransition;
                const slowness = stat.slowness;
                
                if (finger === '같은손가락') {
                    return `같은 손가락으로 연속 타이핑시 ${Math.round((slowness - 1) * 100)}% 지연. 손가락을 빠르게 이동하는 연습이 필요합니다.`;
                } else if (finger === '같은손') {
                    return `같은 손 내에서 ${Math.round((slowness - 1) * 100)}% 지연. 손가락 독립성을 기르는 연습을 하세요.`;
                } else if (finger === '다른손') {
                    return `양손 협응에서 ${Math.round((slowness - 1) * 100)}% 지연. 양손 리듬 연습이 필요합니다.`;
                } else {
                    return `이 키 조합에 대한 반복 연습이 필요합니다.`;
                }
            }

            calculateSpeedVariance() {
                if (this.sentenceTypingData.length <= 1) return 0;
                const speeds = this.sentenceTypingData.map(data => data.wpm);
                return Math.max(...speeds) - Math.min(...speeds);
            }

            analyzeCommonMistakes() {
                const mistakeCount = {};
                this.sentenceTypingData.forEach(data => {
                    data.mistakes.forEach(mistake => {
                        const key = mistake.expected;
                        mistakeCount[key] = (mistakeCount[key] || 0) + 1;
                    });
                });

                return Object.entries(mistakeCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([char, count]) => char);
            }

            analyzeSlowCharacters() {
                const charTimings = {};
                this.sentenceTypingData.forEach(data => {
                    data.keyTimings.forEach(timing => {
                        if (timing.key !== ' ' && timing.interval > 0) {
                            if (!charTimings[timing.key]) {
                                charTimings[timing.key] = [];
                            }
                            charTimings[timing.key].push(timing.interval);
                        }
                    });
                });

                const avgTimings = {};
                Object.entries(charTimings).forEach(([char, timings]) => {
                    avgTimings[char] = timings.reduce((a, b) => a + b, 0) / timings.length;
                });

                if (Object.keys(avgTimings).length === 0) return [];

                const overallAvg = Object.values(avgTimings).reduce((a, b) => a + b, 0) / Object.values(avgTimings).length;

                return Object.entries(avgTimings)
                    .filter(([char, time]) => time > overallAvg * 1.5)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([char, time]) => char);
            }

            restart() {
                try {
                    this.currentProblem = 0;
                    this.resetStats();
                    
                    // 문장연습 데이터 초기화
                    if (this.currentMode === 'sentence') {
                        this.sentenceTypingData = [];
                        this.sentenceMistakes = [];
                        this.sentenceKeyTimings = [];
                        this.keyTransitions = [];
                        this.sentenceStats = []; // 문장별 통계도 초기화
                    }
                    
                    this.generateText();
                    this.updateDisplay();
                    document.getElementById('typingInput').value = '';
                    document.getElementById('completeModal').style.display = 'none';
                    
                    // 모달 클래스 초기화
                    document.getElementById('modalContent').className = 'modal-content';
                    
                    document.getElementById('typingInput').focus();
                } catch (error) {
                    // 재시작 오류 시 기본 상태 유지
                }
            }

            resetStats() {
                try {
                    this.currentPosition = 0;
                    this.startTime = null;
                    this.sentenceStartTime = null;
                    this.lastKeyTime = null;
                    this.lastKeyPressed = null;
                    document.getElementById('accuracy').textContent = '100%';
                    document.getElementById('speed').textContent = '0';
                    document.getElementById('progress').textContent = `1/${this.totalProblems}`;
                } catch (error) {
                    // 통계 초기화 오류 시 기본 상태 유지
                }
            }
        }

        // 드롭다운에서 모드 전환 함수
        function switchMode(mode) {
            if (window.typingPractice) {
                window.typingPractice.changeMode(mode);
            }
        }

        // 영어 타자연습 모드 전환 함수
        function switchEnglishMode(mode) {
            const modeNames = {
                'alphabet': '알파벳',
                'word': '단어',
                'sentence': '문장'
            };
            alert(`영어 ${modeNames[mode]}연습을 시작합니다!\n\n추후 영어 타자연습 페이지에서 구현될 예정입니다.`);
        }

        // 타자게임 함수들
        function playKoreanMoleGame() {
            alert('한글 두더지 잡기 게임을 시작합니다! 🐹\n\n실제 구현에서는 한글 게임 페이지로 이동합니다.');
        }

        function playEnglishMoleGame() {
            alert('영어 두더지 잡기 게임을 시작합니다! 🎯\n\n실제 구현에서는 영어 게임 페이지로 이동합니다.');
        }

        function playKoreanPlaneGame() {
            alert('한글 비행기 조종 게임을 시작합니다! ✈️\n\n실제 구현에서는 한글 비행기 게임 페이지로 이동합니다.');
        }

        function playEnglishPlaneGame() {
            alert('영어 비행기 조종 게임을 시작합니다! 🛩️\n\n실제 구현에서는 영어 비행기 게임 페이지로 이동합니다.');
        }

        function playKoreanDeliveryGame() {
            alert('한글 택배 분류 게임을 시작합니다! 📦\n\n실제 구현에서는 한글 택배 게임 페이지로 이동합니다.');
        }

        function playEnglishDeliveryGame() {
            alert('영어 택배 분류 게임을 시작합니다! 📮\n\n실제 구현에서는 영어 택배 게임 페이지로 이동합니다.');
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.typingPractice = new KoreanTypingPractice();
            } catch (error) {
                // 초기화 오류 시 기본 상태 유지
            }
        });

        // 네비게이션 스크롤 효과
        window.addEventListener('scroll', () => {
            const nav = document.querySelector('nav');
            if (window.scrollY > 100) {
                nav.style.background = 'rgba(255, 255, 255, 0.98)';
            } else {
                nav.style.background = 'rgba(255, 255, 255, 0.95)';
            }
        });

        // 부드러운 스크롤링
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href && href !== '#') {
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }
            });
        });
    </script>
</body>
</html>